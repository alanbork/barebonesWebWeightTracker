<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Date and Weight Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            gap: 40px;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .main-content {
            flex: 1;
            min-width: 400px;
        }
        .chart-container {
            width: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: #f8f8f8;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            flex: 1;
            max-height: 90vh; /* Set a max-height to prevent overflow */
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        .date-input, .weight-input {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        input {
            padding: 8px;
            width: 120px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        #tableContainer {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        #clearDataBtn {
            background-color: #f44336;
            margin-top: 20px;
        }
        #clearDataBtn:hover {
            background-color: #d32f2f;
        }
        #chartCanvas {
            border: 1px solid #ccc;
            background-color: #fff;
            margin-top: 20px;
            flex-grow: 1;
            width: 100%;
        }
        .chart-labels-container {
            width: 100%;
            position: relative;
        }
        .chart-labels-container span {
            font-size: 0.8em;
            color: #555;
            position: absolute;
        }
        /* Date Label - one single string, rotated */
        #dateLabel {
            top: -500px;
            left: 20px;
            transform-origin: 0 0;
            transform: rotate(90deg);
            white-space: nowrap;
			white-space: pre;
			font-weight: bold
			 
        }
        /* Combined weight axis label */
        .weight-axis-label {
            font-size: 0.8em;
            color: #555;
            width: 100%;
            text-align: center;
            margin-top: 5px;
			white-space: pre;
			font-weight: bold
        }
    </style>
</head>
<body>
    <div class="main-content">
        <h1>Date and Weight Tracker</h1>

        <form id="dataForm">
            <div class="form-group">
                <label for="date">Date:</label>
                <div class="date-input">
                    <button type="button" id="dateDecrement">-</button>
                    <input type="text" id="date" placeholder="mm/dd/yy" required>
                    <button type="button" id="dateIncrement">+</button>
                </div>
            </div>

            <div class="form-group">
                <label for="weight">Weight (lbs):</label>
                <div class="weight-input">
                    <button type="button" id="weightDecrement">-</button>
                    <input type="number" id="weight" step="0.1" required>
                    <button type="button" id="weightIncrement">+</button>
                </div>
            </div>

            <button type="submit">Add Entry</button>
        </form>

        <h2>Entries</h2>
        <div id="tableContainer">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Weight (lbs)</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>

        <button type="button" id="clearDataBtn">Clear All Data</button>
    </div>

    <div class="chart-container">
        <h2>Weight Over Time</h2>
        <canvas id="chartCanvas"></canvas>
        <div class="chart-labels-container">
            <span id="dateLabel"></span>
        </div>
        <div class="weight-axis-label"></div>
    </div>

    <script>
        // --- NEW FUNCTION: Scrolls the table container to the bottom ---
        function scrollToBottom() {
            const container = document.getElementById('tableContainer');
            container.scrollTop = container.scrollHeight;
        }

        // LocalStorage functions
        function saveDataToLocalStorage(data) {
            localStorage.setItem('data', JSON.stringify(data));
        }

        function getDataFromLocalStorage() {
            const data = localStorage.getItem('data');
            try {
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error('Error parsing data:', e);
                return [];
            }
        }

        // Date handling functions
        function parseDate(dateString) {
            const parts = dateString.split('/');
            if (parts.length !== 3) return null;
            let month = parseInt(parts[0], 10) - 1;
            let day = parseInt(parts[1], 10);
            let year = parseInt(parts[2], 10);
            if (year < 100) year += 2000;
            const date = new Date(year, month, day);
            if (date.getMonth() !== month || date.getDate() !== day || date.getFullYear() !== year) {
                return null;
            }
            return date;
        }

        function formatDate(date) {
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const year = date.getFullYear();
            return `${month}/${day}/${year % 100}`;
        }
        
 function drawChart(data) {
    const canvas = document.getElementById('chartCanvas');
    const chartContainer = document.querySelector('.chart-container');

    // Adjust canvas size to fit container
    canvas.width = chartContainer.clientWidth - 40;
    canvas.height = chartContainer.clientHeight - 80;

    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const padding = 20;

    ctx.clearRect(0, 0, width, height);

    if (data.length < 2) {
        ctx.textAlign = 'center';
        ctx.font = '14px Arial';
        ctx.fillStyle = '#999';
        ctx.fillText('Add more data to see the chart.', width / 2, height / 2);
        document.querySelector('.weight-axis-label').textContent = '';
        document.getElementById('dateLabel').textContent = '';
        return;
    }

    const parsedData = data.map(d => ({
        date: parseDate(d.date),
        weight: parseFloat(d.weight)
    }));
    const validData = parsedData.filter(d => d.date && !isNaN(d.weight));

    if (validData.length < 2) {
        ctx.textAlign = 'center';
        ctx.font = '14px Arial';
        ctx.fillStyle = '#999';
        ctx.fillText('Add more valid data.', width / 2, height / 2);
        document.querySelector('.weight-axis-label').textContent = '';
        document.getElementById('dateLabel').textContent = '';
        return;
    }

    const weights = validData.map(d => d.weight);
    const minWeight = Math.min(...weights);
    const maxWeight = Math.max(...weights);
    const weightRange = maxWeight - minWeight;

    const dates = validData.map(d => d.date.getTime());
    const minDate = Math.min(...dates);
    const maxDate = Math.max(...dates);
    const dateRange = maxDate - minDate;

    const chartHeight = height - padding * 2;
    const chartWidth = width - padding * 2;
    const minWeightX = padding;

    // Set axis labels
    document.querySelector('.weight-axis-label').textContent = `${minWeight.toFixed(1)} - ${maxWeight.toFixed(1)} lbs`;
    document.getElementById('dateLabel').textContent = `${formatDate(validData[0].date)}  -  ${formatDate(validData[validData.length - 1].date)}`;

    // --- NEW: Draw the grid lines ---
    ctx.strokeStyle = '#e0e0e0';
    ctx.lineWidth = 1;

    // Draw horizontal grid lines for each pound
    for (let w = Math.ceil(minWeight); w <= Math.floor(maxWeight); w++) {
        if (weightRange > 0) {
            const weightX = padding + chartWidth * ((w - minWeight) / weightRange);
            ctx.beginPath();
            ctx.moveTo(weightX, padding);
            ctx.lineTo(weightX, height - padding);
            ctx.stroke();
        }
    }

    // Draw vertical grid lines for each month
    const currentDate = new Date(minDate);
    currentDate.setDate(1); // Set to the first day of the month
    currentDate.setHours(0, 0, 0, 0);

    while (currentDate.getTime() <= maxDate) {
        if (dateRange > 0) {
            const dateY = padding + chartHeight * ((currentDate.getTime() - minDate) / dateRange);
            ctx.beginPath();
            ctx.moveTo(padding, dateY);
            ctx.lineTo(width - padding, dateY);
            ctx.stroke();
        }
        currentDate.setMonth(currentDate.getMonth() + 1);
    }
    // --- END NEW GRID CODE ---

    // Start the path for the filled area
    ctx.beginPath();
    ctx.fillStyle = 'rgba(76, 175, 80, 0.3)';

    // Move to the bottom-left corner of the chart area
    ctx.moveTo(padding, padding);

    // Iterate and draw the area path
    validData.forEach((entry, i) => {
        const dateY = padding + chartHeight * ((entry.date.getTime() - minDate) / dateRange);
        const weightX = padding + chartWidth * ((entry.weight - minWeight) / weightRange);

        // Add points to the path to create the area shape
        ctx.lineTo(weightX, dateY);
    });

    // Close the path by going back to the start of the x-axis, effectively filling the area to the left edge
    ctx.lineTo(minWeightX, padding + chartHeight);
    ctx.closePath();
    ctx.fill();

    // Draw the line on top of the filled area
    ctx.beginPath();
    ctx.strokeStyle = '#4CAF50';
    ctx.lineWidth = 2;
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';

    validData.forEach((entry, i) => {
        const dateY = padding + chartHeight * ((entry.date.getTime() - minDate) / dateRange);
        const weightX = padding + chartWidth * ((entry.weight - minWeight) / weightRange);

        if (i === 0) {
            ctx.moveTo(weightX, dateY);
        } else {
            ctx.lineTo(weightX, dateY);
        }
    });
    ctx.stroke();
}
        // Table rendering function
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            if (!Array.isArray(data) || data.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="2">No entries yet</td>';
                tbody.appendChild(row);
                return;
            }
            data.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.weight}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Event listener for form submission
        document.getElementById('dataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const dateInput = document.getElementById('date');
            const weightInput = document.getElementById('weight');
            const date = parseDate(dateInput.value);
            const weight = parseFloat(weightInput.value);
            if (!date) { alert('Please enter a valid date in mm/dd/yy format'); return; }
            if (isNaN(weight)) { alert('Please enter a valid weight'); return; }

            const newEntry = { date: formatDate(date), weight: weight.toFixed(1) };
            const existingData = getDataFromLocalStorage();

            if (existingData.length === 0 || existingData[existingData.length - 1].weight !== newEntry.weight) {
                existingData.push(newEntry);
                saveDataToLocalStorage(existingData);
                renderTable(existingData);
                drawChart(existingData);
                scrollToBottom();
            }

            const nextDate = new Date(date);
            nextDate.setDate(nextDate.getDate() + 1);
            dateInput.value = formatDate(nextDate);
            weightInput.value = newEntry.weight;
        });

        // Date handlers
        document.getElementById('dateIncrement').addEventListener('click', function() {
            const dateInput = document.getElementById('date');
            const newDate = parseDate(dateInput.value) || new Date();
            newDate.setDate(newDate.getDate() + 1);
            dateInput.value = formatDate(newDate);
        });
        document.getElementById('dateDecrement').addEventListener('click', function() {
            const dateInput = document.getElementById('date');
            const newDate = parseDate(dateInput.value) || new Date();
            newDate.setDate(newDate.getDate() - 1);
            dateInput.value = formatDate(newDate);
        });
        document.getElementById('date').addEventListener('keydown', function(e) {
            if (e.key === 'ArrowUp') { e.preventDefault(); document.getElementById('dateIncrement').click(); }
            if (e.key === 'ArrowDown') { e.preventDefault(); document.getElementById('dateDecrement').click(); }
        });

        // Weight handlers (set to 0.1 increment)
        document.getElementById('weightIncrement').addEventListener('click', function() {
            const weightInput = document.getElementById('weight');
            let currentValue = parseFloat(weightInput.value) || 0;
            currentValue += 0.1;
            weightInput.value = currentValue.toFixed(1);
        });
        document.getElementById('weightDecrement').addEventListener('click', function() {
            const weightInput = document.getElementById('weight');
            let currentValue = parseFloat(weightInput.value) || 0;
            currentValue = Math.max(0, currentValue - 0.1);
            weightInput.value = currentValue.toFixed(1);
        });
        document.getElementById('weight').addEventListener('keydown', function(e) {
            if (e.key === 'ArrowUp') { e.preventDefault(); document.getElementById('weightIncrement').click(); }
            if (e.key === 'ArrowDown') { e.preventDefault(); document.getElementById('weightDecrement').click(); }
        });

        // --- NEW EVENT LISTENER: For the "Clear All Data" button ---
        document.getElementById('clearDataBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to delete all entries? This action cannot be undone.')) {
                localStorage.removeItem('data');
                renderTable([]);
                drawChart([]);
                document.getElementById('date').value = formatDate(new Date());
                document.getElementById('weight').value = '';
            }
        });

        // Initial load and resize handling
        window.addEventListener('DOMContentLoaded', () => {
            const data = getDataFromLocalStorage();
            renderTable(data);
            drawChart(data);
            scrollToBottom();

            if (Array.isArray(data) && data.length > 0) {
                const lastEntry = data[data.length - 1];
                const lastDate = parseDate(lastEntry.date);
                if (lastDate) {
                    const nextDate = new Date(lastDate);
                    nextDate.setDate(nextDate.getDate() + 1);
                    document.getElementById('date').value = formatDate(nextDate);
                }
                document.getElementById('weight').value = lastEntry.weight;
            } else {
                document.getElementById('date').value = formatDate(new Date());
            }
        });

        window.addEventListener('resize', () => {
            const data = getDataFromLocalStorage();
            drawChart(data);
        });
    </script>
</body>
</html>